# Workflow de diagn√≥stico espec√≠fico para Warp Terminal
# Baseado na documenta√ß√£o oficial e ambiente atual
# Data: 2025-09-18

name: "Warp Terminal Diagnostic"
description: "Diagn√≥stico completo e espec√≠fico do Warp Terminal e integra√ß√µes"
command: |
  echo "üîç WARP TERMINAL - DIAGN√ìSTICO COMPLETO"
  echo "======================================="
  echo ""
  
  # Cores para output
  RED='\033[0;31m'
  GREEN='\033[0;32m'
  BLUE='\033[0;34m'
  YELLOW='\033[1;33m'
  CYAN='\033[0;36m'
  BOLD='\033[1m'
  NC='\033[0m'
  
  # Fun√ß√£o para status com emoji
  status_check() {
    if [ $1 -eq 0 ]; then
      echo -e "${GREEN}‚úÖ $2${NC}"
    else
      echo -e "${RED}‚ùå $2${NC}"
    fi
  }
  
  # Fun√ß√£o para info com emoji
  info() {
    echo -e "${BLUE}‚ÑπÔ∏è  $1${NC}"
  }
  
  # Fun√ß√£o para warning com emoji
  warn() {
    echo -e "${YELLOW}‚ö†Ô∏è  $1${NC}"
  }
  
  # === SE√á√ÉO 1: DETEC√á√ÉO WARP TERMINAL ===
  echo -e "${CYAN}${BOLD}1. üöÄ DETEC√á√ÉO WARP TERMINAL${NC}"
  echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
  
  # Verificar se estamos no Warp
  if [[ "${TERM_PROGRAM:-}" == "WarpTerminal" ]]; then
    status_check 0 "Warp Terminal detectado corretamente"
    echo "   Terminal: $TERM_PROGRAM"
  else
    status_check 1 "Warp Terminal n√£o detectado"
    warn "TERM_PROGRAM atual: ${TERM_PROGRAM:-'n√£o definido'}"
  fi
  
  # Verificar vari√°veis de ambiente Warp
  echo ""
  echo "üîß Vari√°veis de Ambiente Warp:"
  warp_vars=("TERM_PROGRAM" "WARP_HONOR_PS1" "WARP_USE_SSH_WRAPPER" "WARP_SHELL_DEBUG_MODE" "WARP_IS_LOCAL_SHELL_SESSION")
  
  for var in "${warp_vars[@]}"; do
    value="${!var:-'n√£o definido'}"
    if [[ "$value" != "n√£o definido" ]]; then
      echo -e "   ${GREEN}‚úì${NC} $var = $value"
    else
      echo -e "   ${YELLOW}‚óã${NC} $var = $value"
    fi
  done
  
  # === SE√á√ÉO 2: CONFIGURA√á√ÉO WARP ===
  echo ""
  echo -e "${CYAN}${BOLD}2. ‚öôÔ∏è CONFIGURA√á√ÉO WARP${NC}"
  echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
  
  # Verificar diret√≥rio .warp
  if [[ -d "$HOME/.warp" ]]; then
    status_check 0 "Diret√≥rio ~/.warp existe"
    
    # Listar conte√∫do
    echo ""
    echo "üìÅ Estrutura ~/.warp:"
    if command -v tree &> /dev/null; then
      tree -L 2 "$HOME/.warp" 2>/dev/null || ls -la "$HOME/.warp"
    else
      ls -la "$HOME/.warp"
    fi
    
    # Verificar arquivos espec√≠ficos
    echo ""
    echo "üìÑ Arquivos de Configura√ß√£o:"
    config_files=("config.json" "workflows" "notebooks")
    for file in "${config_files[@]}"; do
      if [[ -e "$HOME/.warp/$file" ]]; then
        if [[ -d "$HOME/.warp/$file" ]]; then
          count=$(find "$HOME/.warp/$file" -type f 2>/dev/null | wc -l)
          echo -e "   ${GREEN}‚úì${NC} $file/ ($count arquivos)"
        else
          size=$(stat -f%z "$HOME/.warp/$file" 2>/dev/null || stat -c%s "$HOME/.warp/$file" 2>/dev/null || echo "?")
          echo -e "   ${GREEN}‚úì${NC} $file (${size} bytes)"
        fi
      else
        echo -e "   ${RED}‚úó${NC} $file (n√£o encontrado)"
      fi
    done
    
  else
    status_check 1 "Diret√≥rio ~/.warp n√£o existe"
    warn "Execute o setup: ~/workspace/especialistas/warp/scripts/setup-integration.sh"
  fi
  
  # === SE√á√ÉO 3: WORKFLOWS WARP ===
  echo ""
  echo -e "${CYAN}${BOLD}3. üé≠ WORKFLOWS WARP${NC}"
  echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
  
  workflows_dir="$HOME/.warp/workflows"
  if [[ -d "$workflows_dir" ]]; then
    workflow_count=$(find "$workflows_dir" -name "*.yml" -type f 2>/dev/null | wc -l)
    status_check 0 "Diret√≥rio de workflows encontrado"
    info "$workflow_count workflows dispon√≠veis"
    
    if [[ $workflow_count -gt 0 ]]; then
      echo ""
      echo "üìã Workflows Encontrados:"
      find "$workflows_dir" -name "*.yml" -type f 2>/dev/null | while read -r workflow; do
        filename=$(basename "$workflow")
        # Tentar extrair nome do workflow
        if command -v grep &> /dev/null && command -v head &> /dev/null; then
          name=$(grep "^name:" "$workflow" 2>/dev/null | head -1 | cut -d'"' -f2 2>/dev/null || echo "")
          if [[ -n "$name" ]]; then
            echo -e "   ${GREEN}‚ñ∂${NC} $filename ‚Üí \"$name\""
          else
            echo -e "   ${GREEN}‚ñ∂${NC} $filename"
          fi
        else
          echo -e "   ${GREEN}‚ñ∂${NC} $filename"
        fi
      done
    fi
  else
    status_check 1 "Diret√≥rio de workflows n√£o encontrado"
    warn "Workflows n√£o configurados"
  fi
  
  # Verificar workflows do nosso sistema
  our_workflows_dir="/home/notebook/workspace/especialistas/warp/workflows"
  if [[ -d "$our_workflows_dir" ]]; then
    our_count=$(find "$our_workflows_dir" -name "*.yml" -type f 2>/dev/null | wc -l)
    echo ""
    info "Sistema de workflows especialistas: $our_count workflows dispon√≠veis"
  fi
  
  # === SE√á√ÉO 4: INTEGRA√á√ÉO CLAUDE CODE ===
  echo ""
  echo -e "${CYAN}${BOLD}4. ü§ñ INTEGRA√á√ÉO CLAUDE CODE${NC}"
  echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
  
  if command -v claude &> /dev/null; then
    status_check 0 "Claude CLI encontrado"
    
    # Vers√£o Claude
    claude_version=$(claude --version 2>/dev/null | head -1 || echo "Vers√£o n√£o dispon√≠vel")
    info "Vers√£o: $claude_version"
    
    # Teste b√°sico Claude
    echo ""
    echo "üß™ Teste B√°sico Claude CLI:"
    echo "Executando: claude -p \"Echo test: Hello from Warp diagnostic\""
    
    claude_test=$(claude -p "Echo test: Hello from Warp diagnostic" 2>/dev/null | head -1)
    if [[ -n "$claude_test" ]]; then
      status_check 0 "Claude CLI funcionando"
      echo "   Resposta: $claude_test"
    else
      status_check 1 "Claude CLI com problemas"
      warn "Execute: claude doctor"
    fi
    
  else
    status_check 1 "Claude CLI n√£o encontrado"
    warn "Instale Claude Code v1.0.113+"
  fi
  
  # === SE√á√ÉO 5: SHELL E TERMINAL ===
  echo ""
  echo -e "${CYAN}${BOLD}5. üêö SHELL E TERMINAL${NC}"
  echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
  
  # Informa√ß√µes do shell
  echo "Shell Atual: $SHELL"
  if [[ "$SHELL" == */zsh ]]; then
    status_check 0 "Zsh detectado"
    info "Vers√£o Zsh: ${ZSH_VERSION:-'n√£o dispon√≠vel'}"
  else
    status_check 1 "Zsh n√£o √© o shell padr√£o"
  fi
  
  # Verificar Oh My Zsh
  if [[ -d "$HOME/.oh-my-zsh" ]]; then
    status_check 0 "Oh My Zsh instalado"
  else
    status_check 1 "Oh My Zsh n√£o encontrado"
  fi
  
  # Terminal info
  echo ""
  echo "üñ•Ô∏è Informa√ß√µes do Terminal:"
  echo "   TERM: ${TERM:-'n√£o definido'}"
  echo "   COLORTERM: ${COLORTERM:-'n√£o definido'}"
  echo "   Cores: $(tput colors 2>/dev/null || echo 'n√£o dispon√≠vel')"
  
  # === SE√á√ÉO 6: SISTEMA OPERACIONAL ===
  echo ""
  echo -e "${CYAN}${BOLD}6. üíª SISTEMA OPERACIONAL${NC}"
  echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
  
  # OS Info
  if command -v lsb_release &> /dev/null; then
    os_info=$(lsb_release -d 2>/dev/null | cut -f2)
    echo "OS: $os_info"
  else
    echo "OS: $(uname -s) $(uname -r)"
  fi
  
  # WSL Detection
  if grep -qi microsoft /proc/version 2>/dev/null; then
    status_check 0 "WSL2 detectado"
    wsl_info=$(cat /proc/version | grep -oP 'microsoft.*' || echo "WSL")
    info "Ambiente: $wsl_info"
  else
    info "Sistema: Linux nativo"
  fi
  
  # === SE√á√ÉO 7: FERRAMENTAS DE DESENVOLVIMENTO ===
  echo ""
  echo -e "${CYAN}${BOLD}7. üõ†Ô∏è FERRAMENTAS DE DESENVOLVIMENTO${NC}"
  echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
  
  # Lista de ferramentas para verificar
  tools=("git" "node" "npm" "python3" "docker" "vim" "code" "yazi")
  
  echo "Ferramentas Instaladas:"
  for tool in "${tools[@]}"; do
    if command -v "$tool" &> /dev/null; then
      version=$($tool --version 2>/dev/null | head -1 | cut -d' ' -f1-3 2>/dev/null || echo "instalado")
      echo -e "   ${GREEN}‚úì${NC} $tool: $version"
    else
      echo -e "   ${RED}‚úó${NC} $tool: n√£o instalado"
    fi
  done
  
  # === SE√á√ÉO 8: PERFORMANCE E RECURSOS ===
  echo ""
  echo -e "${CYAN}${BOLD}8. üìä PERFORMANCE E RECURSOS${NC}"
  echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
  
  # Recursos do sistema
  echo "Sistema:"
  echo "   CPU: $(nproc) cores"
  if command -v free &> /dev/null; then
    echo "   RAM: $(free -h | awk '/^Mem:/ {print $2}') total, $(free -h | awk '/^Mem:/ {print $7}') dispon√≠vel"
  fi
  echo "   Disk: $(df -h / | awk 'NR==2 {print $4}') dispon√≠vel"
  
  # Performance do shell
  echo ""
  echo "üöÑ Performance:"
  start_time=$(date +%s%N)
  source /dev/null 2>/dev/null
  end_time=$(date +%s%N)
  duration=$(( (end_time - start_time) / 1000000 ))
  echo "   Shell startup: ~${duration}ms"
  
  # === SE√á√ÉO 9: INTEGRA√á√ÉO SISTEMA ESPECIALISTA ===
  echo ""
  echo -e "${CYAN}${BOLD}9. üéì SISTEMA ESPECIALISTA WARP${NC}"
  echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
  
  specialist_dir="/home/notebook/workspace/especialistas/warp"
  if [[ -d "$specialist_dir" ]]; then
    status_check 0 "Sistema especialista encontrado"
    
    # Contar arquivos
    md_count=$(find "$specialist_dir" -name "*.md" -type f 2>/dev/null | wc -l)
    sh_count=$(find "$specialist_dir" -name "*.sh" -type f 2>/dev/null | wc -l)
    yml_count=$(find "$specialist_dir" -name "*.yml" -type f 2>/dev/null | wc -l)
    
    info "Documenta√ß√£o: $md_count arquivos Markdown"
    info "Scripts: $sh_count scripts execut√°veis"
    info "Workflows: $yml_count workflows YAML"
    
    # Verificar arquivos principais
    echo ""
    echo "üìö Documenta√ß√£o Principal:"
    main_docs=("README.md" "docs/INDEX.md" "guides/quick-reference.md")
    for doc in "${main_docs[@]}"; do
      if [[ -f "$specialist_dir/$doc" ]]; then
        lines=$(wc -l < "$specialist_dir/$doc" 2>/dev/null || echo "?")
        echo -e "   ${GREEN}‚úì${NC} $doc ($lines linhas)"
      else
        echo -e "   ${RED}‚úó${NC} $doc (n√£o encontrado)"
      fi
    done
    
    # Verificar scripts
    echo ""
    echo "üîß Scripts Principais:"
    main_scripts=("scripts/setup-integration.sh" "examples/orchestration-script.sh")
    for script in "${main_scripts[@]}"; do
      if [[ -f "$specialist_dir/$script" ]]; then
        if [[ -x "$specialist_dir/$script" ]]; then
          echo -e "   ${GREEN}‚úì${NC} $script (execut√°vel)"
        else
          echo -e "   ${YELLOW}‚óã${NC} $script (n√£o execut√°vel)"
        fi
      else
        echo -e "   ${RED}‚úó${NC} $script (n√£o encontrado)"
      fi
    done
    
  else
    status_check 1 "Sistema especialista n√£o encontrado"
    warn "Clone o sistema: git clone [repo] $specialist_dir"
  fi
  
  # === SE√á√ÉO 10: RECOMENDA√á√ïES ===
  echo ""
  echo -e "${CYAN}${BOLD}10. üí° RECOMENDA√á√ïES${NC}"
  echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
  
  recommendations=0
  
  # Verificar se precisa executar setup
  if [[ ! -d "$HOME/.warp" ]] || [[ ! -f "$HOME/config/warp-integration.zsh" ]]; then
    echo -e "${YELLOW}üìã${NC} Execute o setup de integra√ß√£o:"
    echo "   cd /home/notebook/workspace/especialistas/warp"
    echo "   ./scripts/setup-integration.sh"
    recommendations=$((recommendations + 1))
  fi
  
  # Verificar se Claude est√° funcionando
  if ! command -v claude &> /dev/null; then
    echo -e "${YELLOW}üìã${NC} Instale ou configure Claude Code:"
    echo "   claude doctor"
    recommendations=$((recommendations + 1))
  fi
  
  # Verificar se est√° no Warp
  if [[ "${TERM_PROGRAM:-}" != "WarpTerminal" ]]; then
    echo -e "${YELLOW}üìã${NC} Execute este diagn√≥stico no Warp Terminal para melhor detec√ß√£o"
    recommendations=$((recommendations + 1))
  fi
  
  if [[ $recommendations -eq 0 ]]; then
    echo -e "${GREEN}üéâ${NC} Sistema est√° bem configurado! Nenhuma recomenda√ß√£o."
  fi
  
  # === RESUMO FINAL ===
  echo ""
  echo -e "${CYAN}${BOLD}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
  echo -e "${CYAN}${BOLD}üìä RESUMO DO DIAGN√ìSTICO${NC}"
  echo -e "${CYAN}${BOLD}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
  
  echo ""
  if [[ "${TERM_PROGRAM:-}" == "WarpTerminal" ]] && command -v claude &> /dev/null && [[ -d "$HOME/.warp" ]]; then
    echo -e "${GREEN}${BOLD}‚úÖ STATUS GERAL: EXCELENTE${NC}"
    echo -e "   Warp Terminal + Claude CLI + Configura√ß√£o completa"
  elif [[ "${TERM_PROGRAM:-}" == "WarpTerminal" ]] && command -v claude &> /dev/null; then
    echo -e "${YELLOW}${BOLD}‚ö†Ô∏è  STATUS GERAL: BOM${NC}"
    echo -e "   Warp + Claude funcionando, configura√ß√£o b√°sica"
  else
    echo -e "${RED}${BOLD}‚ùå STATUS GERAL: REQUER ATEN√á√ÉO${NC}"
    echo -e "   Verificar instala√ß√£o do Warp Terminal e Claude Code"
  fi
  
  echo ""
  echo -e "${BLUE}üí° Para mais informa√ß√µes:${NC}"
  echo "   cat /home/notebook/workspace/especialistas/warp/README.md"
  echo "   cat /home/notebook/workspace/especialistas/warp/guides/quick-reference.md"
  
  echo ""
  echo -e "${CYAN}üîÑ Diagn√≥stico conclu√≠do em $(date '+%Y-%m-%d %H:%M:%S')${NC}"

tags: ["diagnostic", "warp", "system", "debug", "health-check"]