# NIST SP 800-207: Zero Trust Architecture for Healthcare

**Document**: NIST Special Publication 800-207
**Status**: Federal Standard (US), Industry Best Practice (Global)
**Healthcare Adaptation**: HIPAA 164.312 + LGPD Art. 46 + CFM 2.314/2022
**Last Updated**: 2025-09-30

---

## Overview

**NIST SP 800-207** defines Zero Trust Architecture (ZTA) as:
> "Security architecture based on the premise that no implicit trust is granted to assets or user accounts based solely on physical or network location."

**Healthcare Context**: Medical systems handle PHI/PII requiring continuous verification (LGPD Art. 46, HIPAA 164.312(b)).

---

## Core Principles

### 1. Verify Explicitly
**Principle**: Authenticate and authorize based on all available data points.

**Healthcare Implementation**:
- **Multi-Factor Authentication** (MFA): TOTP + biometric
- **Continuous Verification**: Re-authenticate every 15 minutes (PHI access)
- **Contextual Authentication**: Location, device, time-of-day, clinical context

**Example** (Elixir):
```elixir
defmodule Healthcare.ZeroTrust.Authentication do
  def verify_access(user, resource, context) do
    with {:ok, _} <- verify_mfa(user),
         {:ok, _} <- verify_device(context.device_id),
         {:ok, _} <- verify_location(context.ip_address),
         {:ok, _} <- verify_time_of_day(context.timestamp),
         {:ok, _} <- verify_clinical_context(user, resource) do
      {:ok, :access_granted}
    else
      {:error, reason} -> 
        Healthcare.AuditLog.write("access_denied", user.id, resource, reason)
        {:error, :access_denied}
    end
  end
end
```

---

### 2. Least Privilege Access
**Principle**: Limit user access to minimum required.

**Healthcare Implementation**:
- **Role-Based Access Control** (RBAC): doctor, nurse, admin
- **Attribute-Based Access Control** (ABAC): ward, specialty, shift
- **Just-In-Time Access**: Temporary elevated privileges (emergency access)

**Example** (PostgreSQL Row-Level Security):
```sql
-- Doctors see only assigned patients
CREATE POLICY doctor_patients ON patients
  FOR SELECT TO doctor_role
  USING (id IN (
    SELECT patient_id FROM doctor_assignments
    WHERE doctor_id = current_setting('app.current_user_id')::UUID
  ));

-- Emergency override (break-glass)
CREATE POLICY emergency_access ON patients
  FOR SELECT TO emergency_role
  USING (
    current_setting('app.emergency_mode')::BOOLEAN = true
    AND current_setting('app.emergency_justification') IS NOT NULL
  );
```

---

### 3. Assume Breach
**Principle**: Design assuming attackers are already inside.

**Healthcare Implementation**:
- **Microsegmentation**: Isolate FHIR API, database, plugin runtime
- **Audit Logging**: Every PHI access logged (LGPD Art. 46, HIPAA 164.312(b))
- **Anomaly Detection**: Behavioral analysis (unusual access patterns)

**Istio Network Policy**:
```yaml
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: fhir-api-deny-by-default
spec:
  selector:
    matchLabels:
      app: fhir-api
  action: DENY
  rules:
  - from:
    - source:
        notNamespaces: ["healthcare"]
```

---

## Zero Trust Components (NIST SP 800-207 Fig. 2)

### Policy Engine (PE)
**Function**: Decide whether to grant access (trust algorithm).

**Healthcare Trust Algorithm**:
```elixir
defmodule Healthcare.ZeroTrust.PolicyEngine do
  def calculate_trust_score(subject, resource, context) do
    scores = [
      authentication_score(subject),      # 25%
      device_health_score(context.device), # 20%
      behavioral_score(subject),          # 20%
      clinical_context_score(context),    # 15%
      compliance_score(subject, resource), # 10%
      network_location_score(context),    # 10%
    ]
    
    weighted_average(scores)
  end
  
  def decide_access(trust_score) do
    cond do
      trust_score >= 80 -> :allow
      trust_score >= 60 -> :allow_with_step_up_auth
      trust_score >= 40 -> :deny_with_justification_option
      true -> :deny
    end
  end
end
```

---

### Policy Administrator (PA)
**Function**: Execute PE decisions (establish/shut down communication).

**Implementation** (Istio mTLS certificates):
```elixir
defmodule Healthcare.ZeroTrust.PolicyAdministrator do
  def grant_access(subject, resource, duration \\ 900) do # 15 min default
    # Issue short-lived mTLS certificate
    {:ok, cert} = Healthcare.PKI.issue_certificate(
      subject: subject.id,
      resource: resource.id,
      validity: duration,
      extensions: %{
        role: subject.role,
        ward: subject.ward,
        specialty: subject.specialty
      }
    )
    
    # Register with Istio
    Healthcare.Istio.register_certificate(cert)
    
    # Audit log
    Healthcare.AuditLog.write("access_granted", subject.id, resource.id, %{
      duration: duration,
      trust_score: subject.trust_score
    })
    
    {:ok, cert}
  end
end
```

---

### Policy Enforcement Points (PEP)
**Function**: Enable/disable communication (enforce PA decisions).

**Healthcare PEPs**:
1. **API Gateway**: Envoy proxy (Istio ingress)
2. **Database Proxy**: PostgreSQL row-level security
3. **WASM Plugin Sandbox**: Extism capability grants

**Envoy Filter** (Istio):
```yaml
apiVersion: networking.istio.io/v1beta1
kind: EnvoyFilter
metadata:
  name: healthcare-pep
spec:
  configPatches:
  - applyTo: HTTP_FILTER
    match:
      listener:
        filterChain:
          filter:
            name: envoy.filters.network.http_connection_manager
    patch:
      operation: INSERT_BEFORE
      value:
        name: envoy.filters.http.ext_authz
        typed_config:
          "@type": type.googleapis.com/envoy.extensions.filters.http.ext_authz.v3.ExtAuthz
          grpc_service:
            envoy_grpc:
              cluster_name: healthcare-policy-engine
          failure_mode_allow: false # Fail closed
```

---

## Healthcare-Specific Trust Sources

### 1. Professional Registry (CFM/CRP)
**Purpose**: Validate doctor/nurse credentials.

**Integration**:
```elixir
defmodule Healthcare.TrustSources.ProfessionalRegistry do
  @cfm_api "https://sistemas.cfm.org.br/api"
  
  def validate_crm(crm, state) do
    case HTTPoison.get("#{@cfm_api}/validate/#{crm}/#{state}") do
      {:ok, %{status_code: 200, body: body}} ->
        data = Jason.decode!(body)
        {:ok, %{
          valid: true,
          name: data["nome"],
          specialty: data["especialidade"],
          active: data["ativo"]
        }}
      _ ->
        {:error, :invalid_crm}
    end
  end
end
```

---

### 2. Patient Consent Management (LGPD Art. 8)
**Purpose**: Verify patient consent for data access.

**Example**:
```elixir
defmodule Healthcare.TrustSources.ConsentManagement do
  def check_consent(patient_id, doctor_id, purpose) do
    consent = Healthcare.Repo.get_by(Consent, 
      patient_id: patient_id,
      purpose: purpose,
      revoked_at: nil
    )
    
    case consent do
      nil -> {:error, :no_consent}
      %{expires_at: expires} when expires < DateTime.utc_now() ->
        {:error, :consent_expired}
      consent ->
        Healthcare.AuditLog.write("consent_verified", patient_id, doctor_id, %{
          consent_id: consent.id,
          purpose: purpose
        })
        {:ok, consent}
    end
  end
end
```

---

## Deployment Models

### Enhanced Identity Governance (Most Common)
**Architecture**: Istio service mesh + Keycloak + PostgreSQL RLS

**Components**:
- **Istio**: mTLS, authorization policies
- **Keycloak**: OAuth2/OIDC, user federation
- **PostgreSQL RLS**: Database-level access control
- **OPA**: Policy as code

**Pros**:
- ✅ Gradual migration (compatible with existing apps)
- ✅ Centralized policy management
- ✅ Proven at scale (Netflix, Spotify)

**Cons**:
- ⚠️ Requires identity provider (Keycloak, Auth0)

---

### Micro-Segmentation (Maximum Security)
**Architecture**: Every service has dedicated PEP, no trust between services

**Use Case**: High-security healthcare (mental health records, HIV/AIDS data)

**Example** (Kubernetes NetworkPolicy):
```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: fhir-api-isolation
spec:
  podSelector:
    matchLabels:
      app: fhir-api
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: elixir-host
    ports:
    - protocol: TCP
      port: 8080
  egress:
  - to:
    - podSelector:
        matchLabels:
          app: postgresql
    ports:
    - protocol: TCP
      port: 5432
```

---

## Metrics & Monitoring

**Key Metrics** (Prometheus):
```yaml
# Trust score distribution
healthcare_trust_score_bucket{le="40"} 12
healthcare_trust_score_bucket{le="60"} 45
healthcare_trust_score_bucket{le="80"} 234
healthcare_trust_score_bucket{le="100"} 1200

# Access decisions
healthcare_access_decision_total{decision="allow"} 45678
healthcare_access_decision_total{decision="deny"} 234
healthcare_access_decision_total{decision="step_up_auth"} 567

# Policy evaluation latency
healthcare_policy_evaluation_seconds{quantile="0.5"} 0.023
healthcare_policy_evaluation_seconds{quantile="0.99"} 0.089
```

---

## Compliance Mapping

| NIST SP 800-207 | HIPAA | LGPD | CFM |
|-----------------|-------|------|-----|
| Verify Explicitly | 164.312(d) Access Control | Art. 46 Security | 2.314/2022 Art. 3 |
| Least Privilege | 164.308(a)(4) Access Management | Art. 46 Minimization | 1.821/2007 Art. 5 |
| Assume Breach | 164.312(b) Audit Controls | Art. 48 Breach Notification | 2.314/2022 Art. 7 |

---

## References

### Official Documentation
- [NIST SP 800-207 PDF](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-207.pdf) (L0_CANONICAL)
- [Istio Security](https://istio.io/latest/docs/concepts/security/) (L0_CANONICAL)
- [Open Policy Agent](https://www.openpolicyagent.org/docs/latest/) (L0_CANONICAL)

### Healthcare Compliance
- [HIPAA Security Rule](https://www.hhs.gov/hipaa/for-professionals/security/index.html) (L0_CANONICAL)
- [LGPD - Lei 13.709/2018](https://www.planalto.gov.br/ccivil_03/_ato2015-2018/2018/lei/l13709.htm) (L0_CANONICAL)

---

**DSM**: [L1:security | L2:healthcare | L3:implementation | L4:guide]
**Source**: `03-zero-trust-security-healthcare.md` (lines 1-800)
**Version**: 1.0.0
**Related**:
- [ADR 004: Zero Trust Implementation](../../01-ARCHITECTURE/adrs/004-zero-trust-implementation.md)
- [CRYSTALS-Kyber](../post-quantum-crypto/crystals-kyber.md)
- [LGPD-HIPAA Mapping](../compliance/lgpd-hipaa-mapping.md)
